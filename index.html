<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rice Field Health Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="display-4 mb-3">Rice Field Prediction System</h1>
            <p class="lead">Analytics for rice field health and yield prediction</p>
        </div>

        <div class="alert alert-danger validation-alert" id="validationAlert">
            <i class="bi bi-exclamation-circle me-2"></i>
            <span id="alertMessage"></span>
        </div>

        <div class="card">
            <div class="card-header">
                <i class="bi bi-upload me-2"></i>Upload Field Information
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="input-group">
                            <label for="fieldWidth">Field Width (meters)</label>
                            <input type="number" id="fieldWidth" class="form-control" placeholder="Enter width" min="1" step="0.1">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <label for="fieldHeight">Field Height (meters)</label>
                            <input type="number" id="fieldHeight" class="form-control" placeholder="Enter height" min="1" step="0.1">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="input-group">
                            <label for="location">Location (Optional)</label>
                            <input type="text" id="location" class="form-control" placeholder="e.g., Central Farm, Region 5">
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="input-group">
                            <label for="imageInput">Upload Field Image</label>
                            <input type="file" id="imageInput" class="form-control" accept=".jpg,.jpeg,.png">
                            <div class="form-text mt-2">Only JPG, JPEG, and PNG files are accepted</div>
                        </div>
                    </div>
                    <div class="col-md-12 text-center">
                        <button onclick="analyze()" class="btn btn-primary w-100 py-3" id="analyzeButton">
                            <i class="bi bi-graph-up me-2"></i>ANALYZE FIELD
                            <span class="spinner-border spinner-border-sm loading-spinner" id="analyzeSpinner"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="results" class="d-none">
            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-image me-2"></i>Image Analysis
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <h5 class="text-center mb-3">Original Image</h5>
                                    <img id="preview" class="analysis-image">
                                </div>
                                <div class="col-md-6 mb-4">
                                    <h5 class="text-center mb-3">Analysis Result</h5>
                                    <div style="position: relative;">
                                        <img id="result" class="analysis-image">
                                        <div id="modelBadge" class="model-badge badge bg-info d-none">
                                            Using Machine Learning
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stats-container">
                                <div class="stat-card healthy">
                                    <div class="stat-title">Healthy Area</div>
                                    <div class="stat-value" id="healthyArea">0m²</div>
                                    <div class="text-muted" id="healthyPercent">0%</div>
                                    <div class="health-indicator">
                                        <div class="health-value bg-success" id="healthyBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div class="stat-card medium">
                                    <div class="stat-title">Medium Area</div>
                                    <div class="stat-value" id="mediumArea">0m²</div>
                                    <div class="text-muted" id="mediumPercent">0%</div>
                                    <div class="health-indicator">
                                        <div class="health-value bg-warning" id="mediumBar" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div class="stat-card unhealthy">
                                    <div class="stat-title">Unhealthy Area</div>
                                    <div class="stat-value" id="unhealthyArea">0m²</div>
                                    <div class="text-muted" id="unhealthyPercent">0%</div>
                                    <div class="health-indicator">
                                        <div class="health-value bg-danger" id="unhealthyBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-bar-chart-line me-2"></i>Yield Analysis
                        </div>
                        <div class="card-body">
                            <div class="stats-container">
                                <div class="stat-card yield">
                                    <div class="stat-title">Estimated Current Yield</div>
                                    <div class="stat-value" id="totalYield">0.00 kg</div>
                                    <div class="text-muted">Based on field health analysis</div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5>Fertilizer Recommendation</h5>
                                    <i class="bi bi-flower3 text-danger" style="font-size: 1.5rem;"></i>
                                </div>
                                <div class="alert alert-light">
                                    <div class="d-flex justify-content-between">
                                        <span>Unhealthy Area Fertilizer Needed:</span>
                                        <strong id="totalFertilizer">0g (0.00kg)</strong>
                                    </div>
                                    <div class="text-muted small mt-2">Calculated at 50g/m² standard rate</div>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="yieldChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <i class="bi bi-clock-history me-2"></i>Historical Data & Prediction Trends
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="mb-4"><i class="bi bi-database me-2"></i>Contribute to Historical Data</h5>
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                <span id="modelExplanation">
                                    Currently using <strong>linear estimation model</strong>.
                                </span>
                                <span id="mlExplanation" class="d-none">
                                    Currently using <strong class="text-success">machine learning model</strong>.
                                </span>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label">Actual Harvest Yield (kg)</label>
                                <input type="number" id="actualYield" class="form-control" min="0" step="0.01">
                            </div>
                            <button onclick="saveActualYield()" class="btn btn-primary w-100" id="submitYieldButton">
                                <i class="bi bi-cloud-upload me-2"></i>Submit Actual Yield
                                <span class="spinner-border spinner-border-sm loading-spinner" id="submitSpinner"></span>
                            </button>
                            <div id="submitStatus" class="text-success small mt-2 d-none">
                                <i class="bi bi-check-circle me-1"></i>Thank you for your contribution!
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h5 class="mb-4"><i class="bi bi-graph-up me-2"></i>Prediction History</h5>
                            <div id="predictionHistory" style="max-height: 300px; overflow-y: auto;">
                                <p class="text-center text-muted my-4" id="emptyHistory">
                                    <i class="bi bi-clock-history"></i><br>
                                    No historical predictions yet
                                </p>
                            </div>
                            <button onclick="loadPredictionHistory()" class="btn btn-outline-secondary w-100 mt-3" id="refreshHistoryButton">
                                <i class="bi bi-arrow-repeat me-2"></i>Refresh History
                                <span class="spinner-border spinner-border-sm loading-spinner" id="refreshSpinner"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="chart-config.js"></script>
    <script src="script.js"></script>
</body>
</html>